# Video Naturalness Evaluation 

This repository represents a crucial step towards more effective and reliable video evaluation
While analyzing the videos generated by text-to-video models, we encountered an issue where some of the videos had poor quality, unrecognizable objects, and were not easily interpretable by humans, despite receiving high scores.
To address this problem, we have created the following repository to evaluate the naturalness of videos.
This was motivated by the limitations of widely-used models like CLIP SIM, which may struggle to accurately interpret non-natural videos that are not easily comprehensible by humans. 
To overcome this challenge, our project leverages the statistical properties of images in combination with no-reference image quality assessment and inception score to distinguish between natural and non-natural videos. By combining these techniques and harnessing machine learning algorythms, we aim to provide a more comprehensive evaluation of video naturalness that can help improve the quality and interpretability of text-to-video models.

### Examples of Non-Natural Images

![Non_nat im1](/Users/AL56801/Downloads/new_repo/Evaluating-Text-to-Video-Models/Video_Naturalness/assets/Non_natural_images_examples/non_natural_eg1.png)![Non_nat im2](/Users/AL56801/Downloads/new_repo/Evaluating-Text-to-Video-Models/Video_Naturalness/assets/Non_natural_images_examples/non_natural_eg2.png)

#### Statistical Properties of an Image:
1. **The color distribution score** measures the uniformity of color in an image. A natural image tends to have a more uniform color distribution, while an unnatural image may have more abrupt changes in color.
2. **The spectral score** measures the degree to which an image deviates from natural image statistics in the Fourier domain. It is calculated by comparing the power spectrum of the image to the average power spectrum of natural images.
3. **Entropy score** is a metric that measures the randomness or disorder of pixel values in an image. Higher entropy_score indicates more disorder and complexity, which is often associated with natural images. Therefore, images with higher entropy_score are considered more natural than those with lower entropy_score.
4. **The contrast score** measures the difference between the lightest and darkest parts of an image. Higher contrast scores indicate that the image has a greater variation in brightness, which can make it look more natural. Conversely, lower contrast scores suggest that an image may appear dull or flat.
5. **Keypoints statstics** is used to compute statistics about keypoints in an image, including the mean, standard deviation, and density of keypoints. This information can be used to measure the naturalness of an image, as natural images tend to have more evenly distributed keypoints with a higher density, while synthetic or manipulated images may have an uneven or sparse distribution of keypoints.
6. **Detecting objects blobs** is used to detect blobs or circular objects in an image using the Laplacian of Gaussian (LoG) method. The function applies a Gaussian filter at different scales to the input image and then computes the Laplacian of each resulting image. The local maxima in the Laplacian images are then detected and the scale at which each maximum occurs is used to determine the size of the detected blob.
7. **The texture score**  function measures the degree of uniformity in the texture of an image, by calculating the variance of the image's gradient magnitude. Higher variance implies higher texture complexity, while lower variance implies lower texture complexity. Images with natural textures such as landscapes or animal fur will have higher texture scores, while images with synthetic or man-made textures may have lower scores.
8. **Sharpness score** measures the amount of high-frequency content in an image, which is indicative of the image's level of detail. A higher sharpness score indicates that an image has more high-frequency content and is therefore more detailed and sharper.
#### No-reference image quality assessment
**NIQE (Natural Image Quality Evaluator)** is a no-reference image quality assessment algorithm that estimates the quality of an image without comparing it to a reference image. It uses a set of natural scene statistics to measure the quality of an image.
**BRISQUE (Blind/Referenceless Image Spatial Quality Evaluator)** is a no-reference image quality assessment algorithm that measures the quality of an image without using a reference image. It uses a set of image features extracted from the image to estimate its quality, and is designed to work well on natural images.
#### Inception Score
Modified Inception Score (MIS), which aims to assess the quality of the generated video by by calculating the mean probability distribution of frames in a video. The modified metric returns a larger value if the mean probability distribution of the frames in a video has low entropy.
#### Trained Dataset
The data that was used to train a classifier is presented in [Statistical_Video_Data.csv](Video_Naturalness/Classifier/Statistical_Video_Data.csv) .By extracting relevant statistical properties from images and utilizing a training dataset consisting of 187 videos from diverse models and real videos. The training data included 92 examples of natural videos and 95 of non natural.  
XGBoost classifier has been trained and tuned via GridSearch on generated data to provide accurate evaluations of video naturalness.

## Examples of results

<table>
  <tr>
    <td style="text-align:center">
      <img src="generated_videos/Tune-a-video/Balloon_full_of_water_exploding_in_extreme_slow_motion.gif" width="250" height="187.5">
      <br>Naturalness score: 0.73036295
    </td>
    <td style="text-align:center">
      <img src="generated_videos/Tune-a-video/A_small_domesticated_carnivorous_mammal_with_soft_fur,_a_short_snout,_and_retractable_claws.gif" width="250" height="187.5">
      <br>Naturalness score: 0.94080323
    </td>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/flying_through_an_intense_battle_between_pirat_ships_in_a_stormy_ocean.gif" width="250" height="187.5">
      <br>Naturalness score: 0.90213525
    </td>
  </tr>
  <tr>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/A_cat_eating_food_out_of_a_bowl.gif" width="250" height="187.5">
      <br>Naturalness score: 0.9235693
    </td>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/Twins_eating_icecream_on_top_of_eiffel_tower_realistic.gif" width="250" height="187.5">
      <br>Naturalness score: 0.15744877
    </td>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/A_swarm_of_bees_flying_around_their_hive.gif" width="250" height="187.5">
      <br>Naturalness score: 0.06740397
    </td>
  </tr>
  <tr>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/eg1.gif" width="250" height="187.5">
      <br>Naturalness score: 0.6321877
    </td>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/An_astronaut_riding_a_horse.gif" width="250" height="187.5">
      <br>Naturalness score: 0.78292175
    </td>
    <td style="text-align:center">
      <img src="Video_Naturalness/assets/video_examples/A_knight_riding_on_a_horse_through_the_countryside.gif" width="250" height="187.5">
      <br>Naturalness score: 0.11610969
    </td>
  </tr>
</table>

---
### Enviroment Setup

You can skip the setup made through the ./setup.sh script but we suggest to create a Python virtual environment to run the code.
We also suggestion using conda to mange the enviroment, using the following commands.
```
$ conda create -n Video_Naturalness anaconda python=3.9
$ conda activate Video_Naturalness
$ ipython kernel install --user --name=Video_Naturalness

$ apt-get update
$ apt-get install libgl1-mesa-glx
$ apt-get install libglib2.0-0
$ apt-get install ffmpeg

$ pip3 install scikit-video
$ pip3 install sentence_transformers
$ pip3 install pyiqa
$ pip install xgboost
```

---
### Running the Script

After you have properly set up the enviroment you can run the Python script [video_processing.py](Video_Naturalness/video_processing.py)
The user will be prompted to provide a path to the desired video file. This script offers the flexibility to process a single video or an entire folder containing multiple videos simultaneously.

---
### Output
The output of the script video_processing.py is saved to the CSV file **naturalness_results.csv**
Contained within this CSV file are the names of each video and their corresponding naturalness score.

### Directory Structure
```
Video_naturalness/
├── Inception/
│   ├── utils.py
│   └── inception_score.py
│   └── inception_model.py
├── Classifier/
│   ├── xgb_model_last.pkl (Trained XGB classifier for image naturalness - currently in use)
│   ├── adaboost_model.pkl (Trained AdaBoost classifier for image naturalness - poor results)
│   ├── naturalness_classifier.ipynb (Experimenting with Classifier Training)
│   └── Statistical_Video_Data.csv (The data the XGB classifier was trained on)
├── image_statistics.py (Python script with all image statistics functions.)
├── video_processing.py (Python script to generate naturalness scores for videos)
├── assets/
├── misc/
└── setup.sh (Optional setup to run Python script)
```
